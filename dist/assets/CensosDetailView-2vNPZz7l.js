import{D as E}from"./Document-CIKjCiaG.js";import{d as $,r as u,B as F,i as z,j as S,o as n,a as i,e,w as x,n as N,F as m,x as w,t as c,k as f,g as k,b as B,p as V,K as A,s as D,h as I,R as L,u as R,_ as M}from"./index-DjIril7E.js";import{v as U,b as j,D as q,d as H,r as T}from"./familias.apis-d_gv-XGO.js";import{C as P}from"./CensoStore-C-V8FRxT.js";const K={class:"row"},G={class:"col"},J={class:"mb-3"},O={class:"card"},Q={class:"card-body"},W={class:"card-title"},X={class:"card-text"},Y={class:"mb-3"},Z=["onClick"],ee={key:1,class:"alert alert-warning alert-dismissible fade show",role:"alert"},se={class:"col"},te={key:0,class:"table table-striped table-hover"},ae={scope:"row"},oe=["onClick","disabled"],le={key:1,class:"alert alert-warning alert-dismissible fade show",role:"alert"},ne=$({__name:"ActualizarRelacionados",setup(C){const r=u(""),d=P(),o=u([]),l=u([]),p=u([]),v=u(""),h=F();z(()=>{l.value=d.relacionados,p.value=d.relacionados}),S(async()=>{if(v.value.length>3){let a=await h.obtenerBeneficiario(parseInt(v.value));l.value=a.filter(s=>!o.value.map(t=>t.item.identificacion).includes(s.identificacion)&&!s.es_censado)}else l.value=p.value.filter(a=>a.es_censado==!1)});const _=a=>{if(!o.value.map(s=>s.item.identificacion).includes(a.identificacion)){o.value.push({item:a,parentezco:r.value}),r.value="";let s=l.value.filter(t=>t.identificacion!=a.identificacion);l.value=s}},y=a=>{if(o.value.map(s=>s.item.identificacion).includes(a.item.identificacion)){let s=o.value.filter(t=>t.item.identificacion!=a.item.identificacion);o.value=s}else{let s=o.value.filter(t=>t.item.identificacion!=a.item.identificacion);o.value=s,l.value.push(a.item)}},g=async()=>{const a={lider:d.lider,relacionados:o.value.map(s=>({identificacion:s.item.identificacion,parentezco:s.parentezco}))};console.log(a),await k("¿Está seguro?","Una vez procesado no podrá modificar los datos, verifique antes de procesar.",()=>{d.añadirRelacionadosNuevos(a)})};return(a,s)=>(n(),i(m,null,[s[9]||(s[9]=e("h6",null,"Seleccione las personas que posee el lider a su cargo",-1)),e("div",K,[e("div",G,[e("div",J,[x(e("input",{type:"text",class:"form-control",id:"inputSearch",placeholder:"Ingrese identificacion a buscar","onUpdate:modelValue":s[0]||(s[0]=t=>v.value=t)},null,512),[[N,v.value]])]),l.value.length?(n(!0),i(m,{key:0},w(l.value,t=>(n(),i("div",O,[e("div",Q,[e("h5",W,c(t.tipo_id+" "+t.identificacion),1),e("div",X,[e("p",null,c(t.nombre+" "+t.apellido),1),e("div",Y,[s[2]||(s[2]=e("label",{for:"inputParentezco",class:"form-label"},"Parentesco",-1)),x(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=b=>r.value=b),id:"inputParentezco"},null,512),[[N,r.value]])])]),e("a",{href:"#",class:"btn btn-primary",onClick:b=>_(t)},s[3]||(s[3]=[e("i",{class:"bi bi-arrow-right"},null,-1)]),8,Z)])]))),256)):(n(),i("div",ee,s[4]||(s[4]=[e("strong",null,"404!",-1),f(" No hay beneficiarios disponibles. ")])))]),e("div",se,[e("h6",null,[s[5]||(s[5]=f("Personas seleccionadas ")),e("button",{type:"button",class:"btn btn-success",onClick:g},"Procesar")]),o.value.length?(n(),i("table",te,[s[7]||(s[7]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"ID"),e("th",{scope:"col"},"Nombre"),e("th",{scope:"col"},"Relación"),e("th",{scope:"col"},"Remover")])],-1)),e("tbody",null,[(n(!0),i(m,null,w(o.value,t=>(n(),i("tr",null,[e("th",ae,c(t.item.tipo_id+" "+t.item.identificacion),1),e("td",null,c(t.item.nombre+" "+t.item.apellido),1),e("td",null,c(t.parentezco),1),e("td",null,[e("button",{class:"btn btn-danger",onClick:b=>y(t),disabled:!!o.value.includes(t.item.identificacion)},s[6]||(s[6]=[e("i",{class:"bi bi-trash"},null,-1)]),8,oe)])]))),256))])])):(n(),i("div",le,s[8]||(s[8]=[e("strong",null,"404!",-1),f(" No hay beneficiarios seleccionados. ")])))])])],64))}}),ie={class:"card"},re={class:"card-header"},ce={class:"card-title"},de={className:"btn btn-group"},ue={class:"card-body"},pe={key:0,class:"table table-striped table-hover"},ve={scope:"row"},be={class:"btn-group",role:"group","aria-label":"Basic example"},me=["onClick"],fe={key:1,class:"alert alert-warning alert-dismissible fade show",role:"alert"},he={class:"modal-dialog",style:{"max-width":"50%",width:"50%"}},_e={class:"modal-content"},ye={class:"modal-header"},ge={class:"modal-body"},we=$({__name:"DetailComponent",setup(C){const r=I(),d=u([]),o=u([]),l=u({}),p=u(!1),v=P(),h=async()=>{const{data:a}=await q(Number(r.currentRoute.value.params.id));l.value=a,console.log(l.value.lider),v.setearLider(l.value.lider)},_=async()=>{const{data:a}=await U(Number(r.currentRoute.value.params.id));d.value=a;for(let s=0;s<d.value.length;s++){const{data:t}=await j(d.value[s]);o.value.push(t)}h()};z(async()=>{_()});const y=async a=>{await k("¿Está seguro de eliminar esta persona del núcleo?","Este proceso no se puede deshacer",()=>{T(a)}).then(s=>{if(D("Hecho","Persona eliminada"),o.value.length>1){let t=o.value.filter(b=>b.identificacion!==a);o.value=t}else o.value=[]})},g=async()=>{await k("¿Está seguro de eliminar este núcleo familiar?","Este proceso no se puede deshacer",()=>{H(Number(r.currentRoute.value.params.id))}).then(a=>{D("Hecho","Núcleo familiar eliminado"),r.push("/censos")})};return(a,s)=>(n(),i(m,null,[e("div",ie,[e("div",re,[e("h4",ce,[f("Lider de familia: "+c(l.value.nombre)+" "+c(l.value.apellido)+" ",1),e("div",de,[e("button",{type:"button",class:"btn btn-default",onClick:s[0]||(s[0]=t=>p.value=!0)}," Añadir beneficiario nuevo "),e("button",{type:"button",class:"btn btn-danger",onClick:g},"Borrar nucleo")])]),s[6]||(s[6]=e("br",null,null,-1)),e("div",ue,[s[5]||(s[5]=e("h5",null,"Personas a cargo",-1)),o.value.length?(n(),i("table",pe,[s[3]||(s[3]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"ID"),e("th",{scope:"col"},"Nombres"),e("th",{scope:"col"},"Parentesco"),e("th",{scope:"col"},"Eliminar")])],-1)),e("tbody",null,[(n(!0),i(m,null,w(o.value,t=>(n(),i("tr",null,[e("th",ve,c(t.tipo_iden)+": "+c(t.identificacion),1),e("td",null,c(t.nombre+" "+t.apellido),1),e("td",null,c(t.parentesco),1),e("td",null,[e("div",be,[e("button",{type:"button",class:"btn btn-danger",onClick:b=>y(t.identificacion)},s[2]||(s[2]=[e("i",{class:"bi bi-trash"},null,-1)]),8,me)])])]))),256))])])):(n(),i("div",fe,s[4]||(s[4]=[e("strong",null,"404!",-1),f(" No hay personas a cargo. ")])))])])]),e("div",{class:V(["modal fade",{show:p.value}]),style:A({display:p.value?"block":"none"})},[e("div",he,[e("div",_e,[e("div",ye,[s[8]||(s[8]=e("h4",{class:"modal-title"},"Añadir beneficiario nuevo",-1)),e("button",{type:"button",class:"close",onClick:s[1]||(s[1]=t=>p.value=!1)},s[7]||(s[7]=[e("span",null,"×",-1)]))]),e("div",ge,[B(ne)])])])],6)],64))}}),ke={class:"col col-lg-8"},De=$({__name:"CensosDetailView",setup(C){let r=[{text:"Atrás",icon:"bi bi-arrow-left",link:"/censos",class:"btn btn-sm btn-secondary",type:"link"}];return L(),(d,o)=>(n(),i("div",ke,[B(M,{title:"Censos",buttons:R(r),icon:R(E),header:"Detalle de Censo",component:we},null,8,["buttons","icon"])]))}});export{De as default};
